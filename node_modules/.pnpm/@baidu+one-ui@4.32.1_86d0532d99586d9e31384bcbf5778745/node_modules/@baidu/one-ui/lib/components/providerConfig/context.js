"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.withConfigConsumer = exports["default"] = exports.Consumer = void 0;

var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _config = require("../config");

/**
 * @file 顶层context
 * @author huangshiming
 * @date 2020-04-28
 */
var context = /*#__PURE__*/_react["default"].createContext(undefined);

var lightThemeComponents = [// components
'select', 'dropdown', 'cascader', 'uploader', 'pagination', 'radio-group', 'checkbox-group', 'input', 'number-input', 'textarea', 'search-box', 'time-picker', 'date-picker', 'button', // containers
'popover', 'tooltip', 'overlay', 'drawer', 'row', 'tabs', 'layout', 'layout-header', 'layout-footer', 'layout-sidebar', 'layout-content'];
var Consumer = context.Consumer;
exports.Consumer = Consumer;
var _default = context;
/**
 * 组件decorator，用于处理全局config
 *
 * @param suffixCls 组件className后缀
 */

exports["default"] = _default;

var withConfigConsumer = function withConfigConsumer(suffixCls) {
  return function (Component) {
    var ComponentWithConsumer = /*#__PURE__*/(0, _react.forwardRef)(function (props, ref) {
      return /*#__PURE__*/_react["default"].createElement(Consumer, null, function (config) {
        if (!config) {
          return /*#__PURE__*/_react["default"].createElement(Component, (0, _extends2["default"])({
            ref: ref
          }, props));
        }

        var size = config.size,
            prefixCls = config.prefixCls,
            theme = config.theme,
            table = config.table;
        var normalizedConfig = suffixCls === 'table' && table && table.loadingOption ? {
          loadingOption: table.loadingOption
        } : {};

        if (size) {
          normalizedConfig.size = size;
        }

        if (prefixCls) {
          normalizedConfig.prefixCls = prefixCls + "-" + suffixCls;
        }

        if (theme) {
          normalizedConfig.theme = theme;
        }

        var className = props.className,
            restProps = (0, _objectWithoutPropertiesLoose2["default"])(props, ["className"]);

        if (theme && (theme !== _config.THEME_LIGHT_D22 || lightThemeComponents.includes(suffixCls))) {
          var themeClassName = prefixCls + "-theme-" + theme;

          if (!className || className.indexOf(themeClassName) === -1) {
            className = (0, _classnames["default"])(className, themeClassName);
          }
        }

        if (className) {
          normalizedConfig.className = className;
        }

        var component = /*#__PURE__*/_react["default"].createElement(Component, (0, _extends2["default"])({
          ref: ref
        }, normalizedConfig, restProps));

        if (theme === _config.THEME_LIGHT_D22 && !lightThemeComponents.includes(suffixCls)) {
          return /*#__PURE__*/_react["default"].createElement(context.Provider, {
            value: (0, _extends2["default"])({}, config, {
              theme: ''
            })
          }, component);
        }

        return component;
      });
    });
    ComponentWithConsumer.displayName = Component.displayName || Component.name;
    return ComponentWithConsumer;
  };
};

exports.withConfigConsumer = withConfigConsumer;