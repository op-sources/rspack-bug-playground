@import '../../style/index.less';

@steps-prefix-cls: ~"@{one-prefix}-steps";

@dls-steps-dot-marker-size-m: @dls-padding-unit * 2.5;
@dls-steps-dot-marker-size-s: @dls-steps-dot-marker-size-m;
@dls-steps-dot-marker-border-width-m: @dls-padding-unit * .5;
@dls-steps-dot-marker-border-width-s: @dls-steps-dot-marker-border-width-m;

@dls-steps-marker-background-color-incomplete: @dls-background-color-neutral;
@dls-steps-marker-background-color-incomplete-hover: @dls-background-color-neutral-hover;
@dls-steps-marker-background-color-incomplete-active: @dls-background-color-neutral-active;
@dls-steps-marker-background-color-incomplete-focus: @dls-background-color-neutral-hover;
@dls-steps-marker-border-color-incomplete: @dls-background-color-neutral-primary;
@dls-steps-marker-border-color-incomplete-hover: @dls-background-color-neutral-primary-hover;
@dls-steps-marker-border-color-incomplete-active: @dls-background-color-neutral-primary-active;
@dls-steps-marker-border-color-incomplete-focus: @dls-background-color-neutral-primary-hover;

@dls-steps-marker-background-color-completed: @dls-background-color-current;
@dls-steps-marker-background-color-completed-hover: @dls-background-color-current-hover;
@dls-steps-marker-background-color-completed-active: @dls-background-color-current-active;
@dls-steps-marker-background-color-completed-focus: @dls-background-color-current-hover;
@dls-steps-marker-border-color-completed: @dls-background-color-info-primary;
@dls-steps-marker-border-color-completed-hover: @dls-background-color-info-primary-hover;
@dls-steps-marker-border-color-completed-active: @dls-background-color-info-primary-active;
@dls-steps-marker-border-color-completed-focus: @dls-background-color-info-primary-hover;

@dls-steps-marker-background-color-current: @dls-background-color-info-primary;
@dls-steps-marker-background-color-current-hover: @dls-background-color-info-primary;
@dls-steps-marker-background-color-current-active: @dls-background-color-info-primary;
@dls-steps-marker-background-color-current-focus: @dls-background-color-info-primary;
@dls-steps-marker-border-color-current: @dls-background-color-info-primary;
@dls-steps-marker-border-color-current-hover: @dls-background-color-info-primary;
@dls-steps-marker-border-color-current-active: @dls-background-color-info-primary;
@dls-steps-marker-border-color-current-focus: @dls-background-color-info-primary;

@dls-steps-marker-background-color-error: @dls-background-color-error;
@dls-steps-marker-background-color-error-hover: @dls-background-color-error-hover;
@dls-steps-marker-background-color-error-active: @dls-background-color-error-active;
@dls-steps-marker-background-color-error-focus: @dls-background-color-error-hover;
@dls-steps-marker-border-color-error: @dls-background-color-error-primary;
@dls-steps-marker-border-color-error-hover: @dls-background-color-error-primary-hover;
@dls-steps-marker-border-color-error-active: @dls-background-color-error-primary-active;
@dls-steps-marker-border-color-error-focus: @dls-background-color-error-primary-hover;

@dls-steps-marker-background-color-error-current: @dls-background-color-error-primary;
@dls-steps-marker-background-color-error-current-hover: @dls-background-color-error-primary;
@dls-steps-marker-background-color-error-current-active: @dls-background-color-error-primary;
@dls-steps-marker-background-color-error-current-focus: @dls-background-color-error-primary;
@dls-steps-marker-border-color-error-current: @dls-background-color-error-primary;
@dls-steps-marker-border-color-error-current-hover: @dls-background-color-error-primary;
@dls-steps-marker-border-color-error-current-active: @dls-background-color-error-primary;
@dls-steps-marker-border-color-error-current-focus: @dls-background-color-error-primary;

@dls-steps-connector-color-incomplete: @dls-line-color-2;

.step-icon-size(@size, @font-size) {
    .@{steps-prefix-cls}-item-icon {
        height: @size;
        width: @size;
        font-size: @font-size;
        box-sizing: border-box;
        > .@{steps-prefix-cls}-icon {
            .@{steps-prefix-cls}-check {
                position: relative;
                font-size: @font-size;
            }
            .@{steps-prefix-cls}-close {
                font-size: @font-size;
            }
        }
    }
}

.dot-step-icon-size(@size, @border-width) {
    .@{steps-prefix-cls}-item-icon {
        height: @size;
        width: @size;
        border-width: @border-width;
    }
}

.vertical-step-positions(@maker-size, @title-font-size) {
    @title-height: dls-line-height(@dls-line-height-1, @title-font-size);
    @maker-title-size-diff: ((@maker-size - @title-height) / 2);
    .@{steps-prefix-cls} {
        &-item {
            &-icon {
                margin-top: max(0px, -@maker-title-size-diff);
            }
            &-title {
                margin-top: max(0px, @maker-title-size-diff);
            }
            &-tail {
                top: ((max(@maker-size, @title-height) + @maker-size) / 2 + @dls-steps-marker-spacing);
                left: (@maker-size / 2);
                height: calc(100% - @maker-size - 2 * @dls-steps-marker-spacing);
            }
        }
    }
}

.horizontal-step-positions(@maker-size, @title-font-size) {
    @title-height: dls-line-height(@dls-line-height-1, @title-font-size);
    @maker-title-size-diff: ((@maker-size - @title-height) / 2);
    .@{steps-prefix-cls} {
        &-item {
            &-icon {
                margin-top: max(0px, -@maker-title-size-diff);
            }
            &-title {
                margin-top: max(0px, @maker-title-size-diff);
            }
            &-tail {
                top: ((max(@maker-size, @title-height) + @maker-size) / 2 + @dls-steps-marker-spacing);
                left: (@maker-size / 2);
                height: calc(100% - @maker-size - 2 * @dls-steps-marker-spacing);
            }
        }
    }
}

.horizontal-step-label-vertical-positions(@maker-size) {
    @connector-left: ((@maker-size + @dls-steps-item-content-width) / 2) + @dls-steps-marker-spacing;
    .@{steps-prefix-cls} {
        &-item {
            &-title,
            &-icon {
                margin-top: 0;
            }
            &-tail {
                top: (@maker-size / 2);
                left: @connector-left;
                width: calc(100% - @maker-size - 2 * @dls-steps-marker-spacing);
            }
        }
    }
}

.step-title-desc-size(@size, @title-font-size, @maker-size, @desc-font-size) {
    .@{steps-prefix-cls}-@{size} {
        .@{steps-prefix-cls}-item-title {
            font-size: @title-font-size;
            &:after {
                top: calc(50% - 0.5px);
            }
        }
        .@{steps-prefix-cls}-item-description {
            font-size: @desc-font-size;
        }
    }
}

.step-color(
    @status,
    @tail-color,
    @foreground-color,
    @title-color,
    @description-color
) {
    &.@{steps-prefix-cls}-item-@{status} {
        .@{steps-prefix-cls}-item-tail {
            &:after {
                background-color: @tail-color;
            }
        }
        .@{steps-prefix-cls}-item-icon {
            .@{steps-prefix-cls}-icon {
                color: @foreground-color;
            }
        }
        .@{steps-prefix-cls}-item-title {
            color: @title-color;
            &:after {
                background-color: @tail-color;
            }
        }
        .@{steps-prefix-cls}-item-description {
            color: @description-color;
        }
    }
}

.step-color-interaction-item(@background-color, @border-color: @background-color) {
    .@{steps-prefix-cls}-item-icon {
        background-color: @background-color;
        border-color: @border-color;
    }
}

.step-title-color(
    @status,
    @title-color-hover,
    @title-color-active,
    @title-color-focus
) {
    &.@{steps-prefix-cls}-item-@{status} {
        &:hover .@{steps-prefix-cls}-item-title {
            color: @title-color-hover;
        }
        &:active .@{steps-prefix-cls}-item-title {
            color: @title-color-active;
        }
        &:focus-visible .@{steps-prefix-cls}-item-title {
            color: @title-color-focus;
        }
    }
}

.step-mark-border-color(
    @status,
    @border-color,
    @border-color-hover,
    @border-color-active,
    @border-color-focus,
    @box-shadow-focus
) {
    &.@{steps-prefix-cls}-item-@{status} {
        @background-color: transparent;
        .@{steps-prefix-cls}-item-icon {
            border-color: @border-color;
            background-color: @background-color;
        }
        &:hover .@{steps-prefix-cls}-item-icon {
            border-color: @border-color-hover;
            background-color: @background-color;
        }
        &:active .@{steps-prefix-cls}-item-icon {
            border-color: @border-color-active;
            background-color: @background-color;
        }
        &:focus-visible .@{steps-prefix-cls}-item-icon {
            border-color: @border-color-focus;
            background-color: @background-color;
            box-shadow: @box-shadow-focus;
        }
    }
}

.step-mark-background-color(
    @status,
    @background-color,
    @background-color-hover,
    @background-color-active,
    @background-color-focus,
    @box-shadow-focus
) {
    &.@{steps-prefix-cls}-item-@{status} {
        @border-color: transparent;
        .@{steps-prefix-cls}-item-icon {
            background-color: @background-color;
            border-color: @border-color;
        }
        &:hover .@{steps-prefix-cls}-item-icon {
            border-color: @border-color;
            background-color: @background-color-hover;
        }
        &:active .@{steps-prefix-cls}-item-icon {
            border-color: @border-color;
            background-color: @background-color-active;
        }
        &:focus-visible .@{steps-prefix-cls}-item-icon {
            border-color: @border-color;
            background-color: @background-color-focus;
            box-shadow: @box-shadow-focus;
        }
    }
}

.@{steps-prefix-cls} {
    font-size: 0;
    width: 100%;
    display: flex;
}
.@{steps-prefix-cls}-item {
    position: relative;
    display: flex;
    overflow: hidden;
    flex: 1;
    &:last-child {
        flex: none;
    }
    &:last-child &-tail,
    &:last-child &-title:after {
        display: none;
    }
    // &-icon,
    &-content {
        display: inline-block;
        vertical-align: top;
    }
    .step-icon-size(@dls-steps-marker-size-m, @dls-steps-marker-font-size-m);
    &-type-dot {
        .dot-step-icon-size(@dls-steps-dot-marker-size-m, @dls-steps-dot-marker-border-width-m);
    }
    &-icon {
        cursor: default;
        text-align: center;
        border-radius: 50%;
        border-width: 1px;
        border-style: solid;
        margin-right: @dls-steps-marker-spacing;
        transition: background-color .3s, border-color .3s;
        position: relative;
        flex-shrink: 0;
        > .@{steps-prefix-cls}-icon {
            color: @dls-steps-marker-foreground-color-incomplete;
            display: inline-flex;
            align-items: center;
        }
    }
    &:not(&-is-current) &-icon {
        cursor: pointer;
    }

    &-tail {
        position: absolute;
        left: 0;
        width: 100%;
        &:after {
            content: '';
            display: inline-block;
            height: 1px;
            border-radius: 1px;
            width: 100%;
            transition: background-color .3s;
        }
    }

    &-title {
        font-weight: @dls-steps-title-font-weight;
        display: inline-block;
        padding-right: @dls-steps-connector-spacing-horizontal;
        position: relative;
        margin-bottom: 0;
        line-height: 1.4;
        display: inline-block;
        position: relative;
        word-wrap: break-word;
        transition-property: color;
        transition-duration: .2s;
        &:after {
            content: '';
            height: 1px;
            width: @dls-steps-max-limit-height;
            display: block;
            position: absolute;
            left: 100%;
          }
    }

    &-description {
        margin-top: @dls-steps-title-spacing;
    }
    .step-color(
        process,
        @dls-steps-connector-color-incomplete,
        @dls-steps-marker-foreground-color-current,
        @dls-steps-title-font-color,
        @dls-steps-desc-font-color
    );
    .step-color(
        wait,
        @dls-steps-connector-color-incomplete,
        @dls-steps-marker-foreground-color-incomplete,
        @dls-steps-title-font-color-incomplete,
        @dls-steps-desc-font-color-incomplete
    );
    .step-color(
        finish,
        @dls-steps-connector-color-incomplete,
        @dls-steps-marker-foreground-color-completed,
        @dls-steps-title-font-color,
        @dls-steps-desc-font-color
    );
    .step-color(
        error,
        @dls-steps-connector-color-incomplete,
        @dls-steps-marker-foreground-color-error,
        @dls-steps-title-font-color,
        @dls-steps-desc-font-color
    );
    .step-title-color(
        process,
        @dls-steps-title-font-color-hover,
        @dls-steps-title-font-color-active,
        @dls-steps-title-font-color-focus
    );
    .step-title-color(
        wait,
        @dls-steps-title-font-color-incomplete,
        @dls-steps-title-font-color-incomplete,
        @dls-steps-title-font-color-incomplete
    );
    .step-title-color(
        finish,
        @dls-steps-title-font-color-hover,
        @dls-steps-title-font-color-active,
        @dls-steps-title-font-color-focus
    );
    .step-title-color(
        error,
        @dls-steps-title-font-color-hover,
        @dls-steps-title-font-color-active,
        @dls-steps-title-font-color-focus
    );

    .step-mark-background-color(
        process,
        @dls-steps-marker-background-color-current,
        @dls-steps-marker-background-color-current-hover,
        @dls-steps-marker-background-color-current-active,
        @dls-steps-marker-background-color-current-focus,
        @dls-steps-marker-shadow-focus
    );
    .step-mark-background-color(
        wait,
        @dls-steps-marker-background-color-incomplete,
        @dls-steps-marker-background-color-incomplete-hover,
        @dls-steps-marker-background-color-incomplete-active,
        @dls-steps-marker-background-color-incomplete-focus,
        0
    );
    .step-mark-background-color(
        finish,
        @dls-steps-marker-background-color-completed,
        @dls-steps-marker-background-color-completed-hover,
        @dls-steps-marker-background-color-completed-active,
        @dls-steps-marker-background-color-completed-focus,
        @dls-steps-marker-shadow-focus
    );
    .step-mark-background-color(
        error,
        @dls-steps-marker-background-color-error,
        @dls-steps-marker-background-color-error-hover,
        @dls-steps-marker-background-color-error-active,
        @dls-steps-marker-background-color-error-focus,
        @dls-steps-marker-shadow-error-focus
    );
    &-is-current {
        .step-mark-background-color(
            error,
            @dls-steps-marker-background-color-error-current,
            @dls-steps-marker-background-color-error-current-hover,
            @dls-steps-marker-background-color-error-current-active,
            @dls-steps-marker-background-color-error-current-focus,
            @dls-steps-marker-shadow-error-focus
        );
    }
    // dot 类型
    &-type-dot {
        .@{steps-prefix-cls}-icon {
            display: none;
        }
        .step-color(
            wait,
            @dls-steps-connector-color-incomplete,
            @dls-steps-marker-foreground-color-incomplete,
            @dls-steps-title-font-color-incomplete,
            @dls-steps-desc-font-color-incomplete
        );
        .step-mark-background-color(
            process,
            @dls-steps-marker-background-color-current,
            @dls-steps-marker-background-color-current-hover,
            @dls-steps-marker-background-color-current-active,
            @dls-steps-marker-background-color-current-focus,
            @dls-steps-marker-shadow-focus
        );
        .step-mark-border-color(
            wait,
            @dls-steps-marker-border-color-incomplete,
            @dls-steps-marker-border-color-incomplete-hover,
            @dls-steps-marker-border-color-incomplete-active,
            @dls-steps-marker-border-color-incomplete-focus,
            0
        );
        .step-mark-border-color(
            finish,
            @dls-steps-marker-border-color-completed,
            @dls-steps-marker-border-color-completed-hover,
            @dls-steps-marker-border-color-completed-active,
            @dls-steps-marker-border-color-completed-focus,
            @dls-steps-marker-shadow-focus
        );
        .step-mark-border-color(
            error,
            @dls-steps-marker-border-color-error,
            @dls-steps-marker-border-color-error-hover,
            @dls-steps-marker-border-color-error-active,
            @dls-steps-marker-border-color-error-focus,
            @dls-steps-marker-shadow-error-focus
        );
    }
    &-type-dot&-is-current {
        .step-mark-background-color(
            error,
            @dls-steps-marker-background-color-error-current,
            @dls-steps-marker-background-color-error-current-hover,
            @dls-steps-marker-background-color-error-current-active,
            @dls-steps-marker-background-color-error-current-focus,
            @dls-steps-marker-shadow-error-focus
        );
    }
    &.@{steps-prefix-cls}-next-process .@{steps-prefix-cls}-item-title:after,
    &.@{steps-prefix-cls}-next-process .@{steps-prefix-cls}-item-tail:after {
        background-color: @dls-steps-connector-color-current;
    }
    &.@{steps-prefix-cls}-next-finish .@{steps-prefix-cls}-item-title:after,
    &.@{steps-prefix-cls}-next-finish .@{steps-prefix-cls}-item-tail:after {
        background-color: @dls-steps-connector-color-completed;
    }
    &.@{steps-prefix-cls}-next-error .@{steps-prefix-cls}-item-title:after,
    &.@{steps-prefix-cls}-next-error .@{steps-prefix-cls}-item-tail:after {
        background-color: @dls-steps-connector-color-error;
    }
}
.@{steps-prefix-cls}-item-error.@{steps-prefix-cls}-item-is-current {
    .@{steps-prefix-cls}-item-icon {
        background-color: @dls-steps-marker-border-color-error;
        color: @dls-color-gray-1;
        &.focus-visible,
        &[data-focus-visible-added] {
            box-shadow: @dls-shadow-error-focus;
        }

        .@{steps-prefix-cls}-icon {
            color: @dls-color-gray-1;
        }
    }
}
.@{steps-prefix-cls}-item-error {
    .@{steps-prefix-cls}-item-icon {
        &.focus-visible,
        &[data-focus-visible-added] {
            box-shadow: @dls-shadow-error-focus;
        }
    }
}

.@{steps-prefix-cls}-horizontal:not(.@{steps-prefix-cls}-label-vertical) {
    .@{steps-prefix-cls}-item {
        margin-right: @dls-steps-connector-spacing-horizontal;
        white-space: nowrap;
        &:last-child {
            margin-right: 0;
        }
        &:last-child .@{steps-prefix-cls}-item-title {
            padding-right: 0;
        }
        &-tail {
            display: none;
        }
        &-title {
            max-width: @dls-steps-title-max-width;
        }
        &-description {
            max-width: @dls-steps-desc-max-width;
            white-space: normal;
        }
    }
}

.@{steps-prefix-cls}-label-vertical {
    .@{steps-prefix-cls}-item {
        flex-direction: column;
        overflow: visible;
        &-tail {
            box-sizing: border-box;
        }
        &-content {
            display: block;
            text-align: center;
            margin-top: @dls-steps-marker-spacing;
            width: @dls-steps-item-content-width;
        }
        &-icon {
            display: inline-block;
            margin-left: (@dls-steps-item-content-width / 2);
            transform: translateX(-50%);
        }
        &-description {
            margin-top: @dls-steps-title-spacing;
        }
        &-title {
            padding-right: 0;
            &:after {
                display: none;
            }
        }
    }
}

.@{steps-prefix-cls}-small {
    &.@{steps-prefix-cls}-horizontal:not(.@{steps-prefix-cls}-label-vertical) .@{steps-prefix-cls}-item {
        &:last-child {
            margin-right: 0;
        }
    }
    .step-icon-size(@dls-steps-marker-size-s, @dls-steps-marker-font-size-s);
    .@{steps-prefix-cls}-item-type-dot {
        .dot-step-icon-size(@dls-steps-dot-marker-size-s, @dls-steps-dot-marker-border-width-s);
    }
    .@{steps-prefix-cls}-item-icon {
        text-align: center;
        border-radius: 50%;
    }
}

.step-title-desc-size(small, @dls-steps-title-font-size-s, @dls-steps-marker-size-s, @dls-steps-desc-font-size-s);
.step-title-desc-size(medium, @dls-steps-title-font-size-m, @dls-steps-marker-size-m, @dls-steps-desc-font-size-m);


.steps-vertical() {
    display: flex;
    flex-direction: column;
    .@{steps-prefix-cls}-item {
        display: block;
        overflow: visible;
        min-height: @dls-steps-vertical-min-height;
        &-icon {
            float: left;
            margin-right: @dls-steps-marker-spacing;
        }
        &-content {
            min-height: @dls-steps-vertical-content-min-height;
            overflow: hidden;
            display: block;
        }
        &-description {
            padding-bottom: @dls-steps-title-spacing;
        }
    }
    > .@{steps-prefix-cls}-item > .@{steps-prefix-cls}-item-tail {
        position: absolute;
        width: 1px;
        &:after {
            height: 100%;
            width: 1px;
        }
    }
    > .@{steps-prefix-cls}-item:not(:last-child) > .@{steps-prefix-cls}-item-tail {
        display: block;
    }
    > .@{steps-prefix-cls}-item > .@{steps-prefix-cls}-item-content > .@{steps-prefix-cls}-item-title {
        &:after {
            display: none;
        }
    }
}
.@{steps-prefix-cls} {
    &-vertical {
        .steps-vertical();
    }

    &-medium&-vertical {
        .vertical-step-positions(@dls-steps-marker-size-m, @dls-steps-title-font-size-m);
    }
    &-small&-vertical {
        .vertical-step-positions(@dls-steps-marker-size-s, @dls-steps-title-font-size-s);
    }

    &-medium&-vertical&-type-dot {
        .vertical-step-positions(@dls-steps-dot-marker-size-m, @dls-steps-title-font-size-m);
    }
    &-small&-vertical&-type-dot {
        .vertical-step-positions(@dls-steps-dot-marker-size-m, @dls-steps-title-font-size-s);
    }
}

.@{steps-prefix-cls} {
    &-medium&-horizontal {
        .horizontal-step-positions(@dls-steps-marker-size-m, @dls-steps-title-font-size-m);
    }
    &-small&-horizontal {
        .horizontal-step-positions(@dls-steps-marker-size-s, @dls-steps-title-font-size-s);
    }
    &-medium&-horizontal&-label-vertical {
        .horizontal-step-label-vertical-positions(@dls-steps-marker-size-m);
    }
    &-small&-horizontal&-label-vertical {
        .horizontal-step-label-vertical-positions(@dls-steps-marker-size-s);
    }

    &-medium&-horizontal&-type-dot {
        .horizontal-step-label-vertical-positions(@dls-steps-dot-marker-size-m);
    }
    &-small&-horizontal&-type-dot {
        .horizontal-step-label-vertical-positions(@dls-steps-dot-marker-size-s);
    }
}

@media (max-width: @dls-steps-max-screen-width) {
    .@{steps-prefix-cls}-horizontal.@{steps-prefix-cls}-label-horizontal {
        .steps-vertical();
    }
}
