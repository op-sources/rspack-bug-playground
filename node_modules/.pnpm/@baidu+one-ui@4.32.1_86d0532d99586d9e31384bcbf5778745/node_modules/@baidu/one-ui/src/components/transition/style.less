@import '../../style/index.less';

.dls-transition-pair(@name, @in, @out: @in) {
    @inName: ~"dls-transition-@{name}-in";
    @outName: ~"dls-transition-@{name}-out";
    @keyframes @inName {
        from {
            @in();
        }
    }
    @keyframes @outName {
        to {
            @out();
        }
    }
}

.dls-transition-pair(
    fade,
    {
        opacity: 0
    }
);

.dls-transition-pair(
    scale,
    {
        transform: scale3d(0, 0, 0);
    }
);

.dls-transition-pair(
    scale-x,
    {
        transform: scaleX(0) scaleZ(0);
    }
);

.dls-transition-pair(
    scale-y,
    {
        transform: scaleY(0) scaleZ(0);
    }
);

.dls-transition-pair(
    translate,
    {
        transform: translate3d(var(--dls-transition-from-x, 0), var(--dls-transition-from-y, 0), 0);
    },
    {
        transform: translate3d(var(--dls-transition-to-x, 0), var(--dls-transition-to-y, 0), 0);
    }
);

.dls-transition-pair(
    translate-x,
    {
        transform: translateX(var(--dls-transition-from-x, 0)) translateZ(0);
    },
    {
        transform: translateX(var(--dls-transition-to-x, 0)) translateZ(0);
    }
);

.dls-transition-pair(
    translate-y,
    {
        transform: translateY(var(--dls-transition-from-y, 0)) translateZ(0);
    },
    {
        transform: translateY(var(--dls-transition-to-y, 0)) translateZ(0);
    }
);

.dls-transition-pair(
    translate-scale,
    {
        transform:
            translate3d(
                var(--dls-transition-from-x, 0),
                var(--dls-transition-from-y, 0),
                0
            )
            scale3d(0, 0, 0);
    },
    {
        transform:
            translate3d(
                var(--dls-transition-to-x, 0),
                var(--dls-transition-to-y, 0),
                0
            )
            scale3d(0, 0, 0);
    }
);

@keyframes dls-transition-translate-gravity-in {
    .gravityIn(@frame: 0, @step: 1) when (@frame <= 100) {
        @ratio: (@frame / 100);
        @xratio: (1 - @ratio);
        @yratio: (1 - @ratio * @ratio);
        @y2ratio: (@xratio * @xratio);
        @frameName: ~"@{frame}%";
        @{frameName} {
            transform:
                translate3d(
                    calc(@xratio * var(--dls-transition-from-x, 0)),
                    ~"min(@{yratio} * var(--dls-transition-from-y, 0), @{y2ratio} * var(--dls-transition-from-y, 0))",
                    0
                )
                scale3d(@ratio, @ratio, 1);
        }
        .gravityIn(@frame + @step);
    }
    .gravityIn();
}

@keyframes dls-transition-translate-gravity-out {
    .gravityOut(@frame: 0, @step: 1) when (@frame <= 100) {
        @xratio: (@frame / 100);
        @ratio: (1 - @xratio);
        @yratio: (@xratio * @xratio);
        @y2ratio: (1 - @ratio * @ratio);
        @frameName: ~"@{frame}%";
        @{frameName} {
            transform:
                translate3d(
                    calc(@xratio * var(--dls-transition-to-x, 0)),
                    ~"min(@{yratio} * var(--dls-transition-to-y, 0), @{y2ratio} * var(--dls-transition-to-y, 0))",
                    0
                )
                scale3d(@ratio, @ratio, 1);
        }
        .gravityOut(@frame + @step);
    }
    .gravityOut();
}

.dls-transition-in(@prefix, @name, @timing-function, @duration, @in: {}) {
    .@{prefix}-enter,
    .@{prefix}-appear {
        animation-name: @name;
        animation-timing-function: @timing-function;
        animation-duration: var(--dls-transition-duration-in, @duration);
        @in();
    }
}

.dls-transition-out(@prefix, @name, @timing-function, @duration, @out: {}) {
    .@{prefix}-exit,
    .@{prefix}-leave {
        animation-name: @name;
        animation-timing-function: @timing-function;
        animation-duration: var(--dls-transition-duration-out, @duration);
        animation-fill-mode: forwards;
        @out();
    }
}

.dls-transition-move() {
    transform: translate(var(--dls-transition-x, 0), var(--dls-transition-y, 0));
    transition-property: transform;
    transition-timing-function:  @dls-transition-timing-function-ease;
    transition-duration: var(--dls-transition-duration-in, @dls-transition-duration-instant);
}

.dls-transition-transform-origin(@prefix, @transform-origin) {
    .@{prefix}-enter,
    .@{prefix}-appear {
        transform-origin: @transform-origin;
    }
    .@{prefix}-exit,
    .@{prefix}-leave {
        transform-origin: @transform-origin;
    }
}
.dls-transition-transform-origin-placement(@prefix, @transform-origin, @placement) {
    .@{prefix}-enter-active[class*="placement-@{placement}"],
    .@{prefix}-appear-active[class*="placement-@{placement}"] {
        transform-origin: @transform-origin;
    }
    .@{prefix}-exit-active[class*="placement-@{placement}"],
    .@{prefix}-leave-active[class*="placement-@{placement}"] {
        transform-origin: @transform-origin;
    }
}

.dls-transition-in(
    one-transition-fade,
    dls-transition-fade-in,
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-fade,
    dls-transition-fade-out,
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);

.dls-transition-in(
    one-transition-scale-fade,
    ~"dls-transition-fade-in, dls-transition-scale-in",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-scale-fade,
    ~"dls-transition-fade-out, dls-transition-scale-out",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);

.dls-transition-in(
    one-transition-slide-right,
    ~"dls-transition-fade-in, dls-transition-scale-x-in",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-slide-right,
    ~"dls-transition-fade-out, dls-transition-scale-x-out",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-transform-origin(one-transition-slide-right, center left);

.dls-transition-in(
    one-transition-slide-left,
    ~"dls-transition-fade-in, dls-transition-scale-x-in",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-slide-left,
    ~"dls-transition-fade-out, dls-transition-scale-x-out",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-transform-origin(one-transition-slide-left, center right);

.dls-transition-in(
    one-transition-slide-down,
    ~"dls-transition-fade-in, dls-transition-scale-y-in",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-slide-down,
    ~"dls-transition-fade-out, dls-transition-scale-y-out",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-transform-origin(one-transition-slide-down, top center);
.dls-transition-transform-origin-placement(
    one-transition-slide-down, bottom center, top);

.dls-transition-in(
    one-transition-slide-up,
    ~"dls-transition-fade-in, dls-transition-scale-y-in",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-slide-up,
    ~"dls-transition-fade-out, dls-transition-scale-y-out",
    @dls-transition-timing-function-linear,
    @dls-transition-duration-instant
);
.dls-transition-transform-origin(one-transition-slide-up, bottom center);
.dls-transition-transform-origin-placement(
    one-transition-slide-up, top center, bottom);

.dls-transition-in(
    one-transition-translate,
    dls-transition-translate-in,
    @dls-transition-timing-function-ease-out,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-translate,
    dls-transition-translate-out,
    @dls-transition-timing-function-ease-in,
    @dls-transition-duration-instant
);

.dls-transition-in(
    one-transition-translate-x,
    dls-transition-translate-x-in,
    @dls-transition-timing-function-ease-out,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-translate-x,
    dls-transition-translate-x-out,
    @dls-transition-timing-function-ease-in,
    @dls-transition-duration-instant
);

.dls-transition-in(
    one-transition-translate-y,
    dls-transition-translate-y-in,
    @dls-transition-timing-function-ease-out,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-translate-y,
    dls-transition-translate-y-out,
    @dls-transition-timing-function-ease-in,
    @dls-transition-duration-instant
);

.dls-transition-in(
    one-transition-translate-scale-fade,
    ~"dls-transition-translate-scale-in, dls-transition-fade-in",
    ~"@{dls-transition-timing-function-ease-out}, @{dls-transition-timing-function-linear}",
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-translate-scale-fade,
    ~"dls-transition-translate-scale-out, dls-transition-fade-out",
    ~"@{dls-transition-timing-function-ease-in}, @{dls-transition-timing-function-linear}",
    @dls-transition-duration-instant
);

.dls-transition-in(
    one-transition-translate-gravity,
    dls-transition-translate-gravity-in,
    @dls-transition-timing-function-ease,
    @dls-transition-duration-instant
);
.dls-transition-out(
    one-transition-translate-gravity,
    dls-transition-translate-gravity-out,
    @dls-transition-timing-function-ease,
    @dls-transition-duration-instant
);
.dls-transition-transform-origin(one-transition-translate-gravity, center);

.one-transition-move {
    .dls-transition-move();
}
