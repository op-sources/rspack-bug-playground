@import '../../style/index.less';
@import '../grid/style.less';
@import '../message/style.less';
@import '../loading/style.less';

@form-prefix-cls: ~"@{one-prefix}-form";
@input-prefix-cls: ~"@{one-prefix}-input";
@number-input-prefix-cls: ~"@{one-prefix}-number-input";
@select-prefix-cls: ~"@{one-prefix}-select";
@button-prefix-cls: ~"@{one-prefix}-button";
@textarea-prefix-cls: ~"@{one-prefix}-textarea";

// update
@dls-form-label-width: 10em;
@dls-form-actions-spacing-before: 8 * @dls-padding-unit;
@dls-form-field-spacing-vertical: 6 * @dls-padding-unit;
@dls-form-label-spacing-after-horizontal: 6 * @dls-padding-unit;
@dls-form-label-spacing-after-horizontal-inline: 2 * @dls-padding-unit;

// add
@dls-form-label-height: 8 * @dls-padding-unit;
@dls-form-field-help-spacing: 2 * @dls-padding-unit;
@dls-form-field-spacing-horizontal: 4 * @dls-padding-unit;

@dls-form-field-spacing-vertical-compact: 4 * @dls-padding-unit;
@dls-form-actions-spacing-before-compact: 6 * @dls-padding-unit;

@dls-form-actions-spacing-before-standalone: 2 * @dls-padding-unit;
@dls-form-grid-column-min-width: 69.5 * @dls-padding-unit;

.form-size(@size, @font-size, @height) {
    .@{form-prefix-cls}-@{size} {
        .@{form-prefix-cls}-item {
            &-required::before {
                font-size: @font-size;
            }
            &-label {
                font-size: @font-size;
                line-height: @height;
            }
            &-control-wrapper {
                line-height: 1;
                display: inline-flex;
                font-size: inherit;
                align-items: center;
            }
            &:last-of-type {
                margin-bottom: 0;
            }
        }
        .@{form-prefix-cls}-explain,
        .@{form-prefix-cls}-extra {
            position: relative;
            font-size: @font-size;
            line-height: 1.5;
            margin-top: @dls-padding-unit;
            clear: both;
            -webkit-transition: color .3s cubic-bezier(.215, .61, .355, 1);
            transition: color .3s cubic-bezier(.215, .61, .355, 1);
            color: rgba(0, 0, 0, 0.45);
        }
        .@{form-prefix-cls}-field {
            font-size: @font-size;
        }
    }
}

.@{form-prefix-cls}-inline {
    .@{form-prefix-cls}-item {
        display: inline-block;
        margin-right: @dls-form-field-spacing-horizontal;
        margin-bottom: 0;
    }
    .@{form-prefix-cls}-item-with-help {
        margin-bottom: 8 * @dls-padding-unit;
    }
    .@{form-prefix-cls}-item > .@{form-prefix-cls}-item-control-wrapper,
    .@{form-prefix-cls}-inline .@{form-prefix-cls}-item > .@{form-prefix-cls}-item-label {
        display: inline-block;
        vertical-align: top;
    }
}

.@{form-prefix-cls} {
    box-sizing: border-box;
    .@{form-prefix-cls}-item {
        margin-bottom: 8 * @dls-padding-unit;
    }
    &-hide-required-mark {
        .@{form-prefix-cls}-field-label-required > label,
        .@{form-prefix-cls}-item-required {
            &::before {
                content: ' ';
            }
        }
    }
}

.@{form-prefix-cls}:not(.@{form-prefix-cls}-inline) {
    .@{form-prefix-cls}-item:last-of-type {
        .@{button-prefix-cls}[type='submit'] {
            margin-top: 2 * @dls-padding-unit;
        }
    }
}

.@{form-prefix-cls}-item {
    .reset-component();
    vertical-align: top;
    display: flex;
    .@{form-prefix-cls}-has-error {
        .format-style(@dls-color-error, @dls-shadow-error-focus);
        .@{input-prefix-cls}-all-container-has-focused {
            .@{input-prefix-cls}-affix-wrapper {
                box-shadow: @dls-input-shadow-error-focus;
            }
        }
        .@{number-input-prefix-cls}-focus {
            border-color: @dls-color-error !important;
            box-shadow: @dls-shadow-error-focus;
        }
    }

    .@{form-prefix-cls}-has-warning {
        .format-style(@dls-color-warning, none);
    }
    &-required::before {
        display: inline-block;
        margin-right: @dls-padding-unit;
        color: @dls-color-error;
        line-height: 1;
        content: '*';
    }
    &-label > label {
        &::after {
            content: ':';
            position: relative;
            top: -0.5px;
            margin: 0 2 * @dls-padding-unit 0 (@dls-padding-unit / 2);
        }
        &.@{form-prefix-cls}-item-no-colon::after {
            content: ' ';
        }
    }
    &-label {
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
        text-align: right;
        vertical-align: middle;
        color: @dls-form-label-font-color;
        line-height: @dls-height-m;
    }
    &-label:not([class*="@{grid-col-prefix-cls}"]) {
        width: var(--dls-form-label-width);
    }
    &-control-wrapper {
        flex: 1;
        display: inline-block;
    }
    &-explain-left {
        .@{form-prefix-cls}-explain,
        .@{form-prefix-cls}-extra {
            text-align: left;
        }
    }
    &-explain-center {
        .@{form-prefix-cls}-explain,
        .@{form-prefix-cls}-extra {
            text-align: center;
        }
    }
    &-explain-right {
        .@{form-prefix-cls}-explain,
        .@{form-prefix-cls}-extra {
            text-align: right;
        }
    }
}

.format-style(@color, @focus-shadow) {
    .@{form-prefix-cls}-explain {
        margin-top: @dls-padding-unit;
        color: @color;
    }
    .@{select-prefix-cls},
    .@{number-input-prefix-cls},
    .@{input-prefix-cls},
    .@{button-prefix-cls},
    .@{textarea-prefix-cls} {
        border-color: @color;
        &:focus, &:active, &:hover {
            border-color: @color;
        }
        &:focus {
            box-shadow: @focus-shadow;
        }
    }
    .@{input-prefix-cls}-affix-wrapper {
        border-color: @color;
        &.focus-visible, &:active, &:hover {
            border-color: @color;
        }
        &.focus-visible {
            box-shadow: @focus-shadow;
        }
        .@{input-prefix-cls} {
            border: none;
            &.focus-visible, &:active, &:hover {
                border: none;
            }
            &.focus-visible {
                box-shadow: none;
            }
        }
    }
}

.@{form-prefix-cls} {
    &:not(&-legacy)&-inline {
        display: flex;
        align-items: flex-start;
        flex-wrap: wrap;
    }
    &-inline &-field {
        display: inline-flex;
        &:not(:last-of-type) {
            margin-right: @dls-form-field-spacing-horizontal;
        }
    }
    &-inline &-field-label {
        margin-right: @dls-form-label-spacing-after-horizontal-inline;
    }
    &-field {
        display: flex;
        &:not(:last-of-type):not(&-abstract) {
            margin-bottom: @dls-form-field-spacing-vertical;
        }
        &-actions {
            margin-top: @dls-form-actions-spacing-before;
        }
        &-label {
            justify-content: flex-end;
            align-items: center;
            display: flex;
            height: @dls-form-label-height;
            width: @dls-form-label-width;
            width: var(--dls-form-label-width, @dls-form-label-width);
            margin-right: @dls-form-label-spacing-after-horizontal;
            position: relative;
            flex-shrink: 0;
            line-height: dls-even(dls-line-height(@dls-line-height-1, @dls-font-size-1));
            color: @dls-form-label-font-color;
            &-left {
                justify-content: flex-start;
            }
            &-required > label::before {
                content: "*";
                margin-right: @dls-form-label-content-spacing;
                color: @dls-form-label-required-color;
            }
            &-align-help {
                align-items: baseline;
            }
        }
        &-main {
            display: flex;
            flex-direction: column;
        }
        &-content {
            display: flex;
            align-items: center;
            flex: 1 0 auto;
            position: relative;
            min-height: @dls-form-label-height;
        }
        &-messages {
            margin-bottom: -@dls-form-field-spacing-vertical;
            min-height: @dls-form-field-spacing-vertical;
            padding-bottom: @dls-form-field-error-spacing-before-vertical;
            display: flex;
            flex-direction: column;
            .@{message-prefix-cls} {
                margin-top: @dls-form-field-error-spacing-before-vertical;
            }
            .@{loading-prefix-cls} {
                justify-content: left;
                padding: 0;
                margin-top: @dls-form-field-error-spacing-before-vertical;
            }
        }
        &-message {
            margin-top: @dls-form-field-error-spacing-before-vertical;
        }
        &-help-position-top&-help {
            margin-bottom: @dls-form-field-error-spacing-before-vertical;
        }
        &-help-position-side&-help {
            margin-left: @dls-form-field-help-spacing;
        }
    }
    &-label-position-side&-inline &-field-tip {
        margin-left: @dls-form-label-content-spacing;
    }
    &-label-position-side:not(&-inline) &-field-tip {
        position: absolute;
        left: calc(100% + @dls-padding-unit);
    }
    &-label-position-top &-field {
        flex-direction: column;
    }
    &-label-position-top &-field-label {
        text-align: left;
        justify-content: left;
        width: auto;
        height: auto;
        margin-bottom: @dls-padding-unit;
    }
    &-label-position-top &-field-tip {
        margin-left: @dls-form-label-content-spacing;
    }
    &-label-position-top &-field-label &-field-help {
        margin-left: @dls-form-label-content-spacing;
        margin-bottom: 0;
    }
    &-type-compact &-field:not(&-abstract):not(:last-of-type) {
        margin-bottom: @dls-form-field-spacing-vertical-compact;
    }
    &-type-compact &-field-actions {
        margin-top: @dls-form-actions-spacing-before-compact;
    }
    &-type-compact &-field-messages {
        margin-bottom: -@dls-form-field-spacing-vertical-compact;
    }
    &-inline &-field-actions,
    &-grid &-field-actions {
        margin-top: 0;
    }
    &-inline &-field-actions&-field-standalone,
    &-grid &-field-actions&-field-standalone {
        margin-top: @dls-form-actions-spacing-before-standalone;
    }
    &-grid {
        display: grid;
        align-items: flex-start;
        grid-template-columns: repeat(
            auto-fit,
            minmax(var(--dls-form-grid-column-min-width, @dls-form-grid-column-min-width), 1fr)
        );
    }
    &-inline &-field-standalone {
        width: 100%;
    }
    &-grid &-field-standalone {
        grid-column: 1 / -1;
    }
}

.form-size(small, @dls-font-size-0, @dls-height-s);
.form-size(medium, @dls-font-size-1, @dls-height-m);
.form-size(large, @dls-font-size-2, @dls-height-l);