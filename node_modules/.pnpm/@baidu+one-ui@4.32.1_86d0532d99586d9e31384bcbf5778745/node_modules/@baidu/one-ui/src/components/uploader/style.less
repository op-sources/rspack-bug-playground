@import '../../style/index.less';
@import "../button/style.less";
@import "../dialog/style.less";
@import "../progress/style.less";
@import "../popover/style.less";
@import "../loading/style.less";

@uploader-prefix-cls: ~"@{one-prefix}-uploader";
@modal-prefix-cls: ~"@{one-prefix}-dialog";
@progress-prefix-cls: ~"@{one-prefix}-progress";
@loading-prefix-cls: ~"@{one-prefix}-loading";
@button-prefix-cls: ~"@{one-prefix}-button";
@dls-uploader-media-item-min-size-s: @dls-height-unit * 15;
@dls-uploader-media-item-max-size-s: @dls-height-unit * 30;
@dls-uploader-media-item-min-size-m: @dls-height-unit * 25;
@dls-uploader-media-item-max-size-m: @dls-height-unit * 75;

// update
@dls-uploader-file-item-spacing-y: 2 * @dls-padding-unit;
@dls-uploader-media-error-spacing: @dls-padding-unit;
@dls-uploader-media-icon-size-s: 6 * @dls-padding-unit;
@dls-uploader-help-spacing-x: 2 * @dls-padding-unit;
@dls-uploader-help-spacing-y: @dls-padding-unit;
@dls-uploader-media-entry-content-spacing: @dls-padding-unit;
@dls-uploader-file-item-width: 66 * @dls-padding-unit;
@dls-uploader-media-spacing-x-s: 3 * @dls-padding-unit;
@dls-uploader-media-spacing-x-m: 4 * @dls-padding-unit;

// add
@dls-uploader-file-item-padding-y: @dls-padding-unit;
@dls-uploader-background-color-error: @dls-background-color-error;  // 文件上传错误背景
@dls-uploader-media-background-color: @dls-background-color-base-2; // 媒体背景色
// 描述安全边距
@dls-uploader-media-text-spacing-s: @dls-padding-unit 2 * @dls-padding-unit 0;
@dls-uploader-media-text-spacing-m: @dls-padding-unit 3 * @dls-padding-unit 0;
@dls-uploader-media-side-help-max-width: 80 * @dls-padding-unit;

.uploader-size(
    @size,
    @card-height,
    @card-width,
    @card-min-size,
    @card-max-size,
    @border-radius,
    @icon-size,
    @icon-padding,
    @font-size,
    @dls-uploader-media-text-spacing,
    @dls-uploader-media-spacing-x,
    @dls-uploader-media-spacing-y
) {
    .@{uploader-prefix-cls}-image.@{uploader-prefix-cls}-@{size} {
        font-size: @font-size;
        .@{uploader-prefix-cls}-image-item {
            margin-right: @dls-uploader-media-spacing-x;
            margin-top: @dls-uploader-media-spacing-y;
            &-helper-bottom {
                width: @card-width;
            }
            &-error-message {
                margin: @dls-uploader-media-text-spacing;
            }
            .@{uploader-prefix-cls}-image-item-card {
                height: @card-height;
                width: @card-width;
                min-width: @card-min-size;
                min-height: @card-min-size;
                max-width: @card-max-size;
                max-height: @card-max-size;
                border-radius: @border-radius;
                &-error,
                &-footer {
                    width: @card-width;
                }
            }
            .@{uploader-prefix-cls}-add-icon {
                font-size: @icon-size;
            }
            .@{uploader-prefix-cls}-video-add-icon,
            .@{uploader-prefix-cls}-media-add-icon,
            .@{uploader-prefix-cls}-image-add-icon {
                width: @icon-size;
                height: @icon-size;
                border-radius: @border-radius;
            }
        }
        .@{uploader-prefix-cls}-anchor-video,
        .@{uploader-prefix-cls}-anchor-media,
        .@{uploader-prefix-cls}-anchor-image {
            margin-top: @dls-uploader-media-spacing-y;
            &-helper-bottom:not(.@{uploader-prefix-cls}-anchor-standalone) {
                width: @card-width;
            }
            &-button {
                border-radius: @border-radius;
                &-text {
                    margin: @dls-uploader-media-text-spacing;
                }
            }
            .@{uploader-prefix-cls}-anchor-image-button {
                height: @card-height;
                width: @card-width;
                min-width: @card-min-size;
                min-height: @card-min-size;
                max-width: @card-max-size;
                max-height: @card-max-size;
            }
            .@{uploader-prefix-cls}-add-icon {
                font-size: @icon-size;
            }
            .@{uploader-prefix-cls}-image-add-icon,
            .@{uploader-prefix-cls}-video-add-icon,
            .@{uploader-prefix-cls}-media-add-icon {
                width: @icon-size;
                height: @icon-size;
            }
        }
        .@{uploader-prefix-cls}-list {
            margin-top: -@dls-uploader-media-spacing-y;
            &-item {
                font-size: @font-size;
                &-fail-icon,
                &-success-icon,
                &-close-icon {
                    right: @icon-padding;
                }
            }
        }
        &.@{uploader-prefix-cls}-picker-position-before {
            .@{uploader-prefix-cls}-anchor {
                margin-right: @dls-uploader-media-spacing-x;
            }
        }
        .@{uploader-prefix-cls}-image-item-card-operation {
            font-size: @font-size;
        }
    }
}

.uploader-size(
    small,
    var(--dls-uploader-media-item-height, @dls-uploader-media-height-s),
    var(--dls-uploader-media-item-width, @dls-uploader-media-width-s),
    @dls-uploader-media-item-min-size-s,
    @dls-uploader-media-item-max-size-s,
    @dls-button-border-radius-s,
    @dls-uploader-media-icon-size-s,
    @dls-uploader-media-content-spacing-s,
    @dls-uploader-font-size-s,
    @dls-uploader-media-text-spacing-s,
    @dls-uploader-media-spacing-x-s,
    @dls-uploader-media-spacing-y-s
);
.uploader-size(
    medium,
    var(--dls-uploader-media-item-height, @dls-uploader-media-height-m),
    var(--dls-uploader-media-item-width, @dls-uploader-media-width-m),
    @dls-uploader-media-item-min-size-m,
    @dls-uploader-media-item-max-size-m,
    @dls-button-border-radius-m,
    @dls-uploader-media-icon-size-m,
    @dls-uploader-media-content-spacing-m,
    @dls-uploader-font-size-m,
    @dls-uploader-media-text-spacing-m,
    @dls-uploader-media-spacing-x-m,
    @dls-uploader-media-spacing-y-m
);

.@{uploader-prefix-cls} {
    zoom: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    &-input {
        display: none;
    }
    &-anchor {
        &-file {
            &-container {
                display: inline-block;
            }
            &-container-right {
                .@{uploader-prefix-cls}-helper-text {
                    margin-left: @dls-uploader-help-spacing-x;
                }
            }
            &-container-bottom {
                .@{uploader-prefix-cls}-helper-text {
                    margin-top: @dls-uploader-help-spacing-y;
                    display: block;
                }
            }
            .@{uploader-prefix-cls}-helper-text {
                font-size: @dls-uploader-font-size-s;
                color: @dls-uploader-helper-text-font-color;
            }
        }
    }
    &-list:not(&-list-image) + &-anchor,
    &-anchor + &-list:not(&-list-image) {
        margin-top: @dls-uploader-file-item-spacing-y;
    }
    &-list {
        width: @dls-uploader-file-item-width;
        .@{uploader-prefix-cls}-file {
            &-item {
                margin-bottom: @dls-uploader-file-item-spacing-y;
                padding: @dls-uploader-file-item-padding-y @dls-uploader-file-item-padding-x;
                background-color: @dls-uploader-file-item-background-color;
                &-container {
                    display: flex;
                    align-items: center;
                }
                &-label {
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                    flex: 1;
                    margin-left: @dls-uploader-file-item-label-spacing;
                    margin-right: @dls-uploader-file-item-action-spacing;
                }
                &-progress {
                    width: calc(100% - 8px);
                    position: absolute;
                    font-size: 0;
                    bottom: -@dls-uploader-file-item-padding-y;
                }
                &-error .@{uploader-prefix-cls}-file-item-message {
                    color: @dls-color-error;
                    padding-left: calc(@dls-uploader-file-item-label-spacing + @dls-icon-size-normal);
                    margin-top: @dls-padding-unit;
                    font-size: @dls-uploader-font-size-s;
                }
                &:hover {
                    background-color: @dls-uploader-file-item-background-color-hover;
                }
                &-error,
                &-error:hover {
                    background-color: @dls-uploader-background-color-error;
                }
                &-uploading {
                    position: relative;
                }
                &-control {
                    margin-left: 2 * @dls-padding-unit;
                }
                &-file-icon {
                    height: @dls-icon-size-normal;
                    color: @dls-foreground-color-neutral;
                    vertical-align: middle;
                }
                &-fail-icon,
                &-success-icon,
                &-close-icon {
                    font-size: @dls-uploader-font-size-s;
                }
                &-success-icon {
                    color: @dls-color-success;
                }
            }
        }
        .@{uploader-prefix-cls}-sortable {
            .@{uploader-prefix-cls}-anchor-image,
            .@{uploader-prefix-cls}-image-item {
                display: inline-flex;
                vertical-align: top;
                float: none;
            }
        }
        .@{uploader-prefix-cls}-image {
            &-item {
                position: relative;
                float: left;
                &-card {
                    height: 100%;
                    border: 1px solid @dls-button-border-color-basic;
                    box-sizing: border-box;
                    background-color: @dls-button-background-color-basic;
                    position: relative;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-direction: column;
                    overflow: hidden;
                    .@{progress-prefix-cls} {
                        &-outer {
                            width: 100%;
                        }
                        &-inner {
                            width: 100%;
                        }
                    }
                    &:hover:not(.@{uploader-prefix-cls}-image-item-card-hide) {
                        .@{uploader-prefix-cls}-image-item-card-operation {
                            display: block;
                        }
                    }
                    &-operation {
                        position: absolute;
                        bottom: 0;
                        width: 100%;
                        text-align: right;
                        padding: @dls-uploader-mask-padding-y 0;
                        display: none;
                        &-hide {
                            display: none;
                        }
                        &-mask {
                            position: absolute;
                            left: 0;
                            top: 0;
                            right: 0;
                            bottom: 0;
                            background-color: @dls-color-gray-10;
                            opacity: .6;
                        }
                        &-icons {
                            z-index: 1;
                            position: relative;
                            >svg {
                                margin-right: @dls-uploader-mask-icon-spacing;
                                color: @dls-color-gray-1;
                                cursor: pointer;
                                height: 4 * @dls-height-unit;
                            }
                        }
                    }
                    &-operation-overlay-open {
                        display: block;
                    }
                    &-footer {
                        margin-top: @dls-height-unit;
                        font-size: @dls-uploader-font-size-s;
                    }
                    &-error {
                        margin-top: @dls-height-unit;
                        color: @dls-color-error;
                        font-size: @dls-uploader-font-size-s;
                        word-break: break-all;
                    }
                }
                &-uploading-container,
                .@{uploader-prefix-cls}-video-add-icon,
                .@{uploader-prefix-cls}-media-add-icon,
                .@{uploader-prefix-cls}-image-add-icon {
                    position: relative;
                    top: -2px;
                    color: @dls-uploader-media-icon-color;
                }
                .@{uploader-prefix-cls}-add-icon {
                    color: @dls-uploader-media-icon-color;
                }
                &-uploading-container {
                    width: 80%;
                    text-align: center;
                }
                &-thumbUrl {
                    width: 100%;
                    height: 100%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    position: relative;
                    background-color: @dls-uploader-media-background-color;
                    &-image {
                        width: auto;
                        height: auto;
                        max-width: 100%;
                        max-height: 100%;
                        position: absolute;
                        top: auto;
                        right: 50%;
                        bottom: 50%;
                        left: auto;
                        transform: translate(50%,50%);
                    }
                }
            }
            &-item-error {
                .@{uploader-prefix-cls}-image-item-card {
                    border: 1px solid @dls-color-error;
                }
                .@{uploader-prefix-cls}-image-item-error-message {
                    color: @dls-color-error;
                    text-align: center;
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                    overflow: hidden;
                    .@{uploader-prefix-cls}-question-icon {
                        position: relative;
                        top: 1px;
                        cursor: pointer;
                    }
                }
            }
        }
    }
    &-small&-image &-image-item-error-message {
        -webkit-line-clamp: 4;
        margin-top: 0;
    }
    &-anchor-has-entries {
        .@{uploader-prefix-cls}-entries-icon {
            display: inline-block;
        }
        .@{uploader-prefix-cls}-entries-path {
            display: none;
            text-align: center;
        }
        .@{uploader-prefix-cls}-entries-item {
            cursor: pointer;
        }
        .@{uploader-prefix-cls}-entries-item-disabled {
            cursor: not-allowed;
            color: @dls-foreground-color-neutral-disabled;

        }
        &:hover {
            .@{uploader-prefix-cls}-entries-icon {
                display: none;
            }
            .@{uploader-prefix-cls}-entries-path {
                display: block;
                .@{uploader-prefix-cls}-entries-item {
                    // display: block;
                    &-icon {
                        display: inline-block;
                    }
                    &-label {
                        display: inline-block;
                        .@{button-prefix-cls}-text {
                            padding: 0;
                        }
                    }
                }
            }
        }
        .@{uploader-prefix-cls}-anchor-image-button-overlay-open {
            background-color: @dls-button-background-color-basic-hover;
            .@{uploader-prefix-cls}-entries-icon {
                display: none;
            }
            .@{uploader-prefix-cls}-entries-path {
                display: block;
                opacity: 1;
                width: auto;
                .@{uploader-prefix-cls}-entries-item {
                    // display: block;
                    &-icon {
                        display: inline-block;
                    }
                    &-label {
                        display: inline-block;
                        .@{button-prefix-cls}-text {
                            padding: 0;
                        }
                    }
                }
            }
        }
        .@{uploader-prefix-cls}-anchor-image-button {
            padding: @dls-uploader-media-entry-spacing;
            box-sizing: border-box;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-align: left;
            &:active {
                background-color: @dls-button-background-color-basic-hover;
            }
            .@{uploader-prefix-cls}-entries-item {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                margin-bottom: @dls-uploader-media-entry-spacing;
                .@{uploader-prefix-cls}-entries-item-icon {
                    margin-right: @dls-uploader-media-entry-content-spacing;
                    height: @dls-uploader-media-entry-icon-size;
                    .dls-icon {
                        height: @dls-uploader-media-entry-icon-size;
                    }
                }
                &:last-of-type {
                    margin-bottom: 0;
                }
            }
        }
        cursor: auto !important;
    }
}

.@{uploader-prefix-cls}-file-item-popover {
    font-size: @dls-uploader-font-size-s;
}
.@{uploader-prefix-cls}-add-icon {
    line-height: 1;
}
.@{uploader-prefix-cls}-anchor-video,
.@{uploader-prefix-cls}-anchor-media,
.@{uploader-prefix-cls}-anchor-image {
    position: relative;
    float: left;
    vertical-align: top;
    &-button {
        width: 100%;
        height: 100%;
        display: inline-flex;
        cursor: pointer;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        box-sizing: border-box;
        &-text {
            color: @dls-foreground-color-neutral-weak;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .@{uploader-prefix-cls}-add-icon,
        .@{uploader-prefix-cls}-image-add-icon,
        .@{uploader-prefix-cls}-video-add-icon,
        .@{uploader-prefix-cls}-media-add-icon {
            color: @dls-uploader-media-icon-color;
        }
        &-disabled {
            .@{uploader-prefix-cls}-add-icon,
            .@{uploader-prefix-cls}-image-add-icon,
            .@{uploader-prefix-cls}-video-add-icon,
            .@{uploader-prefix-cls}-media-add-icon {
                color: @dls-icon-color-aux-disabled;
            }
        }
        &-disabled &-text {
            color: @dls-icon-color-aux-disabled;
        }
        .button-normal-style(
            @dls-button-background-color-basic,
            @dls-button-font-color-basic,
            @dls-button-border-color-basic,
            @dls-button-background-color-basic-hover,
            @dls-button-background-color-basic-active,
            @dls-button-background-color-basic-disabled,
            @dls-button-font-color-basic-disabled,
            @dls-button-border-color-basic-disabled
        );
        &-loading {
            position: relative;
            background-color: @dls-button-background-color-basic-active;
            &:hover, &:active, &:focus {
                background-color: @dls-button-background-color-basic-active;
            }
            cursor: not-allowed;
            .@{loading-prefix-cls} {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
        }
    }
}

.@{one-theme-light-d22} .@{uploader-prefix-cls}-anchor-image-button {
    .button-normal-style(
        @dls-button-background-color-normal-d22,
        @dls-button-font-color-normal,
        transparent,
        @dls-button-background-color-normal-hover-d22,
        @dls-button-background-color-normal-active-d22,
        @dls-button-background-color-normal-disabled-d22,
        @dls-button-font-color-normal-disabled,
        @dls-button-border-color-normal-disabled
    );
}
.@{one-theme-light-d22}
    .@{uploader-prefix-cls}-image-item:not(.@{uploader-prefix-cls}-image-item-error)
    .@{uploader-prefix-cls}-image-item-card {
        border-color: @dls-button-border-color-normal-disabled;
        background-color: @dls-button-background-color-normal-d22;
        .@{uploader-prefix-cls}-image-item-thumbUrl {
            background-color: transparent;
        }
}

.@{uploader-prefix-cls}-list-image {
    width: 100%;
    box-sizing: border-box;
    color: @dls-uploader-file-item-font-color;
    font-feature-settings: "tnum";
    zoom: 1;
    margin: 0;
    padding: 0;
    font-variant: tabular-nums;
    list-style: none;
}

.@{uploader-prefix-cls}-modal {
    &-blank {
        display: inline-block;
        min-width: 200px;
        height: 200px;
    }
    &-image {
        width: 100%;
    }
    .@{modal-prefix-cls}-header {
        opacity: 0;
    }
    .@{modal-prefix-cls}-footer {
        display: none;
    }
}

.@{uploader-prefix-cls}-image {
    &:before {
        display: table;
        content: '';
    }
    &:after {
        clear: both;
    }
    .@{uploader-prefix-cls}-list {
        &:before {
            display: table;
            content: '';
        }
        &:after {
            clear: both;
        }
    }
    .@{uploader-prefix-cls}-anchor-image,
    .@{uploader-prefix-cls}-image-item {
        display: flex;
        &-helper-bottom {
            flex-direction: column;
        }
        .@{uploader-prefix-cls}-helper-text {
            color: @dls-uploader-helper-text-font-color;
            font-size: @dls-uploader-font-size-s;
        }
        &-helper-right .@{uploader-prefix-cls}-helper-text {
            margin-left: @dls-uploader-help-spacing-x;
            max-width: @dls-uploader-media-side-help-max-width;
        }
        &-helper-bottom .@{uploader-prefix-cls}-helper-text {
            margin-top: @dls-uploader-help-spacing-y;
        }
    }
}

.uploader-overlay-options(@size, @font-size, @height, @padding, @overlay-max-width) {
    .@{uploader-prefix-cls}-entries-item-menus-@{size} {
        max-width: @overlay-max-width;
        font-size: @font-size;
        .@{uploader-prefix-cls}-entries-item-menus-label {
            height: @height;
            line-height: @height;
            padding: 0 @padding;
            display: block;
            cursor: pointer;
            &:hover {
                background-color: @dls-option-background-color-hover;
                color: @dls-option-font-color-hover;
            }
            &:active {
                background-color: @dls-option-background-color-active;
                color: @dls-option-font-color-active;
            }
            &.focus {
                background-color: @dls-option-background-color-focus;
                color: @dls-option-font-color-focus;
            }
        }
    }
}

.uploader-overlay-options(small, @dls-option-font-size-s, @dls-option-height-s, @dls-option-padding-s, @dls-option-max-width-s);
.uploader-overlay-options(medium, @dls-option-font-size-m, @dls-option-height-m, @dls-option-padding-m, @dls-option-max-width-m);

.@{uploader-prefix-cls}-image.@{uploader-prefix-cls}-picker-position-before {
    .@{uploader-prefix-cls}-list {
        .@{uploader-prefix-cls}-image-item {
            &:last-of-type {
                margin-right: 0;
            }
        }
    }
}
.@{uploader-prefix-cls} {
    &-image &-list {
        display: flex;
        flex-wrap: wrap;
    }
    &-anchor-standalone {
        width: 100%;
    }
}