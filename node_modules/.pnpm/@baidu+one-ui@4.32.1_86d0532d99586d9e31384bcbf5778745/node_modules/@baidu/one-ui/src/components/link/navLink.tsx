/**
 * @file 支持react-router的link
 * @author huangshiming@baidu.com
 * @date 2020-11-26
 */

import React, {forwardRef} from 'react';
import Link from './textLink';
import {NavLinkProps} from './interface';

function isModifiedEvent(event) {
    return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);
}

const NavLink = forwardRef<Link, NavLinkProps>((props, ref) => {
    const {target, onClick, navigate, ...restProps} = props;
    const handleOnClick = event => {
        try {
            if (onClick) {
                onClick(event);
            }
        }
        catch (ex) {
            event.preventDefault();
            throw ex;
        }

        if (!event.defaultPrevented
            && event.button === 0
            && (!target || target === '_self')
            && !isModifiedEvent(event)) {
            event.preventDefault();
            navigate();
        }
    }

    return (
        <Link
            {...restProps}
            target={target}
            isAtag
            ref={ref}
            onClick={handleOnClick}
        />
    );
});

export default NavLink;
